---
title: 计算机网络
date: 2020-03-01 00:39:40
categories: 网络
tags: 网络
---

## 序
HTTP和HTTPS的原理

## 认识 HTTP
首先你听的最多的应该就是` HTTP `是一种 超文本传输协议`(Hypertext Transfer Protocol)`

那么什么是超文本传输协议？
超文本传输协议可以进行文字分割：`超文本（Hypertext）`、`传输（Transfer）`、`协议（Protocol）`

按照范围的大小 协议 > 传输 > 超文本。下面就分别对这三个名次做一个解释。

### 什么是超文本
在互联网早期的时候，我们输入的信息只能保存在本地，无法和其他电脑进行交互。我们保存的信息通常都以文本即简单字符的形式存在，文本是一种能够被计算机解析的有意义的二进制数据包。而随着互联网的高速发展，两台电脑之间能够进行数据的传输后，人们不满足只能在两台电脑之间传输文字，还想要传输图片、音频、视频，甚至点击文字或图片能够进行超链接的跳转，那么文本的语义就被扩大了，这种语义扩大后的文本就被称为超文本(Hypertext)。
### 什么是传输
两台计算机之间会形成互联关系进行通信，我们存储的超文本会被解析成为二进制数据包，由传输载体（例如同轴电缆，电话线，光缆）负责把二进制数据包由计算机终端传输到另一个终端的过程（对终端的详细解释可以参考 你说你懂互联网，那这些你知道么？这篇文章）称为传输(transfer)。
### 什么是协议
自己一个人对自己的约定不能成为协议，协议的前提条件必须是多人约定。
网络协议就是网络中(包括互联网)传递、管理信息的一些规范。如同人与人之间相互交流是需要遵循一定的规矩一样，计算机之间的相互通信需要共同遵守一定的规则，这些规则就称为网络协议。

> ### 总结:
HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范

## 与 HTTP 有关的组件
### 网络模型
- 应用层(web:`HTTP`,电子邮件:`SMTP`,端系统文件上传协议:`FTP`,域名解析:`DNS`)
- 运输层(`TCP`和 `UDP`)
- 网络层(`IP`)
- 链路层
    - (以太网、`WiFi `和电缆接入的 `DOCSIS` 协议)分组称为`帧(frame)`
    - 作用:将帧从一个端系统运输到另一个端系统
    - ARP和RARP是数据链路层协议，是一对协议，分别是MAC和IP地址互查的（RARP把MAC转换成IP地址）

- 物理层(将帧中的一个个 比特 从一个节点运输到另一个节点)


### OSI 模型(国际标准化组织)
OSI 要比上面的网络模型多了 表示层 和 会话层，其他层基本一致
- 应用层
- 表示层
- 会话层
- 运输层
- 网络层
- 链路层
- 物理层
## HTTP长连接和短连接
像`web`网站的`http`服务一般都是短连接，因为长连接对于服务端来说会耗费一定的资源，像`web`网站这么频繁的成千上万甚至上亿客户端连接用短连接会更省一些资源，数据库连接一般是长连接频繁请求资源的客户端适合长连接。长连接可以省去较多的`TCP`建立和关闭操作，减少浪费，节约资源

## HTTP的请求
## HTTP 的优点和缺点
### HTTP 的优点
- 简单灵活易扩展
- 应用广泛、环境成熟
- 无状态
### HTTP 的缺点
- 无状态
- 通信使用明文(不加密)，内容可能会被窃听
- 不验证通信方的身份，有可能遭遇伪装
- 无法证明报文的完整性，所以有可能已遭篡改
- 性能



## 确保Web安全的HTTPS(身披SSL外壳的HTTP)
与SSL组合使用的`HTTP`被称为`HTTPS`(超文本传输安全协议`HTTP over SSL`)，
HTTP+加密+认证+完整性保护=HTTPS

共享密钥加密：共享密钥加密就是在HTTPS原理中人们常说到的对称加密，那么什么是共享密钥加密呢？其实就是两个所用的密钥是同一个。但是其实在共享密钥加密会有一个密钥传递的不安全，因为很可能会被第三方给替换掉，所以就有了一种公开密钥加密。

公开密钥加密：公开密钥加密就是HTTPS中人们常说到的非对称加密。那么什么是公开密钥加密呢？公开密钥加密会有两个密钥，一个是主密钥也称做私有密钥，这个一般是不能发送给别人的，一个是公共密钥，这个可以给任何人。其原理就是发送方使用接收方给的公共密钥来加密数据，发送给接收方，然后接收方用私钥来解密。这样数据的安全性就高了很多。但这样也不是说一定安全，只是第三方在不知道私钥的时候去解密其实就是对离散对数的求值，难度很大，目前的技术很难实现。
[加密机制](https://blog.csdn.net/MierCurry/article/details/104564378)
1. 浏览器使用`https`的`url`访问服务器，建立`SSL`连接
2. 服务器接收到`SSL`链接后，发送非对称加密公钥`A`给浏览器
3. 浏览器生成随机数，作为对称加密的秘钥`B`
4. 浏览器使用服务器返回的公钥`A`，对自己生成的对称加密秘钥`B`进行加密，得到秘钥`C`
5. 浏览器将秘钥`C`发送给服务器
6. 服务器使用自己的私钥`D`对接受的秘钥`C`进行解密，得到对称加密秘钥`B`
7. 浏览器和服务器之间使用秘钥`B`作为对称加密秘钥通信

#### 说明：通过上面流程浏览器和服务器之间共享一个对称加密秘钥B，而且不会被人监听和拦截到，之后的消息传递使用秘钥B进行对称加密

#### 优点：非对称加密只使用了一次，后续所有通信消息都是用对称加密，效率比非对称加密高

#### HTTPS的数字证书？
中间人可以截取服务器发送给客户端的公钥，冒充服务器将自己的公钥发送给客户端，之后客户端会用中间人公钥进行加密生成对称秘钥，把密钥发给服务器，这时中间人又可以截取对称加密的秘钥。
非对称加密之所以不安全，因为客户端不知道这把公钥是不是属于服务器的

#### 引入数字证书
认证中心（CA）：一个拥有公信力、大家都认可的认证中心，数字证书认证机构
证书内容：签发者、证书用途、公钥、加密算法、Hash算法、证书到期时间

#### 使用证书认证过程：

1. 服务器在给客户端传输公钥过程中，会把公钥和服务器的个人信息通过hash算法生成信息摘要
2. 为了防止信息要被调换，服务器采用CA提供的私钥对信息摘要进行加密来形成数字签名
3. 最后把原来没hash算法之前的个人信息、公钥及数字签名合并在一起，形成数字证书
4. 客户端拿到数字证书之后，使用CA提供的公钥对数字证书里的数字签名进行解密来得到信息摘要，然后对数字证书里的服务器的公钥及个人信息利用hash算法得到另一份信息摘要，最后将两份信息摘要对比，如果一样则证明是服务器，否则就是中间人

#### 认证中心、数字证书、数字签名
个人信息+公钥+数字签名===数字证书

#### CA证书的颁发？
服务器一开始向认证中心申请证书，客户端也内置了这些证书。

#### HTTP和RPC的区别？
底层协议：Http是基于http协议，RPC基于TCP，也可以是http，自己定义的协议
效率：RPC基于自定义的TCP，可以让请求报文体积更小，提高传输效率。
性能消耗：RPC基于高效的二进制流传输，消耗低，HTTP大部分通过json来实现，字节大小和序列化都比RPC要消耗性能
RPC自带了负载均衡，HTTP需要配置Nginx实现
RPC主要用于公司内部服务调用，性能消耗低，传输效率高，服务治理方便；HTTP主要对外如浏览器接口调用，app和第三方接口调用。

#### 加密算法
摘要算法：MD5（128位）、SHA1（160位），是一种不可逆的过程，无论多大的数据，经过摘要算法后都生成相同长度的数据。只能通过字典进行破解。
对称加密算法：DES、AES，加密解密时使用相同的秘钥。
非对称加密算法：RSA，加密解密时使用不同的秘钥，对接支付宝使用RSA2。